# üöÄ Vira Services Code Generator

**Generate complete Spring Boot services with CRUD operations, tests, and React integration - Offline & Standalone!**

This utility generates production-ready Spring Boot code for your Vira Services project based on simple JSON configuration files. Perfect for developers who need to add new services quickly without AI assistance.

## üìã Table of Contents

- [Features](#features)
- [Quick Start](#quick-start)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [Service Definition Format](#service-definition-format)
- [Examples](#examples)
- [Generated Files](#generated-files)
- [Troubleshooting](#troubleshooting)
- [Advanced Usage](#advanced-usage)
- [Contributing](#contributing)

## ‚ú® Features

### üéØ **Complete Code Generation**
- **Spring Boot Model** - JPA entities with validation
- **Repository Layer** - Spring Data JPA with custom queries
- **Service Layer** - Business logic with error handling
- **Controller Layer** - REST APIs with security
- **DTO Classes** - Request/Response objects with validation
- **Database Migration** - Flyway SQL scripts with indexes
- **Unit Tests** - Comprehensive test coverage
- **Integration Tests** - API and repository tests
- **React Integration** - TypeScript API service files

### üîí **Security & Validation**
- Input sanitization for XSS protection
- SQL injection prevention
- Bean validation annotations
- JWT security integration
- CORS configuration

### üèóÔ∏è **Architecture Compliance**
- Follows Vira Services conventions
- Proper package structure
- Consistent naming patterns
- Spring Boot best practices
- Clean code principles

### üöÄ **Production Ready**
- Comprehensive error handling
- Logging integration
- Performance optimizations
- Database indexing
- API documentation (Swagger)

## üöÄ Quick Start

### 1. **Update Configuration**
Edit `config.json` to point to your Vira Services project:

```json
{
  "paths": {
    "vira_services_root": "C:/path/to/your/vira_services",
    "src_main_java": "C:/path/to/your/vira_services/src/main/java/com/vira",
    "src_main_resources": "C:/path/to/your/vira_services/src/main/resources"
  }
}
```

### 2. **Create Service Definition**
Copy and modify `service_definition.json`:

```json
{
  "service": {
    "name": "blog",
    "description": "Blog post management service"
  },
  "database": {
    "table": "blog_posts",
    "entity": "BlogPost"
  },
  "fields": [
    {
      "name": "id",
      "type": "BIGSERIAL",
      "javaType": "Long",
      "primaryKey": true,
      "autoGenerated": true
    },
    {
      "name": "title",
      "type": "VARCHAR(255)",
      "javaType": "String",
      "validation": {
        "required": true,
        "maxLength": 255
      }
    }
  ]
}
```

### 3. **Generate Code**
Run the generator:

```bash
# Using Python
python generator.py

# Or with custom files
python generator.py --config my_config.json --definition my_service.json

# Enable verbose logging
python generator.py --verbose
```

### 4. **Deploy**
Commit the generated files and deploy to Railway or your platform!

## üì¶ Installation

### Option 1: Python Installation

1. **Install Python 3.8+**
   ```bash
   # Download from https://python.org
   python --version  # Verify installation
   ```

2. **Install Dependencies**
   ```bash
   cd utilities
   pip install -r requirements.txt
   ```

3. **Run Generator**
   ```bash
   python generator.py
   ```

### Option 2: Bundled Executable (Coming Soon)

Download `generator.exe` and double-click to run - no Python installation needed!

## üéØ Usage

### Basic Usage

```bash
# Generate with default config
python generator.py

# Specify custom files
python generator.py --config my_config.json --definition blog_service.json

# Enable detailed logging
python generator.py --verbose
```

### Step-by-Step Process

1. **Configure Paths** - Update `config.json` with your project paths
2. **Define Service** - Create/modify `service_definition.json`
3. **Validate** - Generator validates your JSON before proceeding
4. **Generate** - All files are created with proper structure
5. **Review** - Check generated files and logs
6. **Test** - Run your Spring Boot application
7. **Deploy** - Commit and deploy to production

## ‚öôÔ∏è Configuration

### config.json Structure

```json
{
  "project": {
    "name": "Vira Services Code Generator",
    "version": "1.0.0"
  },
  "paths": {
    "vira_services_root": "C:/path/to/vira_services",
    "src_main_java": "C:/path/to/vira_services/src/main/java/com/vira",
    "src_main_resources": "C:/path/to/vira_services/src/main/resources",
    "src_test_java": "C:/path/to/vira_services/src/test/java/com/vira",
    "migration_path": "C:/path/to/vira_services/src/main/resources/db/migration",
    "frontend_resources": "C:/path/to/vira_services/src/main/resources/frontend"
  },
  "generation": {
    "include_react_integration": true,
    "include_tests": true,
    "include_migration": true,
    "overwrite_existing": false
  },
  "validation": {
    "sql_injection_protection": true,
    "xss_protection": true,
    "input_sanitization": true
  },
  "logging": {
    "level": "INFO",
    "file": "./logs/generator.log",
    "console": true
  },
  "rollback": {
    "enabled": true,
    "backup_directory": "./backups"
  }
}
```

### Key Configuration Options

| Option | Description | Default |
|--------|-------------|---------|
| `overwrite_existing` | Whether to overwrite existing files | `false` |
| `include_tests` | Generate test classes | `true` |
| `include_react_integration` | Generate React API services | `true` |
| `sql_injection_protection` | Enable SQL injection validation | `true` |
| `rollback.enabled` | Enable automatic rollback on failure | `true` |

## üìù Service Definition Format

### Complete Structure

```json
{
  "service": {
    "name": "service_name",           // Required: alphanumeric, no spaces
    "displayName": "Service Name",    // Optional: human-readable name
    "description": "Service description",
    "version": "1.0.0",
    "author": "Your Name"
  },
  "database": {
    "table": "service_table_name",    // Required: snake_case
    "entity": "EntityName",           // Required: PascalCase
    "repository": "EntityRepository", // Optional: auto-generated
    "service": "EntityService",       // Optional: auto-generated
    "controller": "EntityController"  // Optional: auto-generated
  },
  "fields": [
    {
      "name": "field_name",           // Required: snake_case
      "type": "SQL_TYPE",             // Required: PostgreSQL type
      "javaType": "JavaType",         // Required: Java type
      "primaryKey": true/false,       // Optional: default false
      "nullable": true/false,         // Optional: default true
      "autoGenerated": true/false,    // Optional: default false
      "description": "Field description",
      "validation": {
        "required": true/false,
        "maxLength": 255,
        "minLength": 1,
        "min": 0,
        "max": 999999,
        "pattern": "regex_pattern",
        "email": true/false,
        "sanitize": true/false
      },
      "foreignKey": {
        "table": "referenced_table",
        "field": "referenced_field",
        "onDelete": "CASCADE"
      }
    }
  ],
  "operations": {
    "create": true,
    "read": true,
    "update": true,
    "delete": true,
    "list": true,
    "pagination": true,
    "customQueries": [
      {
        "name": "methodName",
        "description": "Query description",
        "query": "SELECT * FROM {tableName} WHERE field = ?",
        "parameters": ["Type paramName"],
        "returnType": "List<Entity>"
      }
    ]
  },
  "api": {
    "basePath": "/api/service/entity",
    "secured": true,
    "corsEnabled": true,
    "endpoints": [
      {
        "method": "GET|POST|PUT|DELETE",
        "path": "/custom-path",
        "operation": "operation_name",
        "description": "Endpoint description",
        "security": "USER|ADMIN"
      }
    ]
  },
  "testing": {
    "generateUnitTests": true,
    "generateIntegrationTests": true,
    "generateRepositoryTests": true,
    "testDataSamples": [
      {
        "field_name": "sample_value"
      }
    ]
  },
  "frontend": {
    "generateApiService": true,
    "generateTypeDefinitions": true,
    "framework": "react",
    "language": "typescript"
  }
}
```

### Field Types Mapping

| SQL Type | Java Type | Validation Options |
|----------|-----------|-------------------|
| `BIGSERIAL` | `Long` | Primary key, auto-generated |
| `BIGINT` | `Long` | min, max |
| `INTEGER` | `Integer` | min, max |
| `DECIMAL(p,s)` | `BigDecimal` | min, max, precision, scale |
| `VARCHAR(n)` | `String` | maxLength, pattern, email |
| `TEXT` | `String` | maxLength, sanitize |
| `TIMESTAMP` | `LocalDateTime` | future, past |
| `DATE` | `LocalDate` | future, past |
| `BOOLEAN` | `Boolean` | required |

### Validation Rules

```json
{
  "validation": {
    "required": true,              // @NotNull, @NotBlank for strings
    "maxLength": 255,             // @Size(max = 255)
    "minLength": 1,               // @Size(min = 1)
    "min": 0,                     // @DecimalMin("0")
    "max": 999999,                // @DecimalMax("999999")
    "pattern": "^[A-Z0-9-]+$",    // @Pattern(regexp = "...")
    "email": true,                // @Email
    "sanitize": true,             // XSS protection
    "future": true,               // @Future (for dates)
    "past": true                  // @Past (for dates)
  }
}
```

## üìö Examples

### Simple Entity

```json
{
  "service": {
    "name": "task",
    "description": "Task management service"
  },
  "database": {
    "table": "tasks",
    "entity": "Task"
  },
  "fields": [
    {
      "name": "id",
      "type": "BIGSERIAL",
      "javaType": "Long",
      "primaryKey": true,
      "autoGenerated": true,
      "description": "Task ID"
    },
    {
      "name": "title",
      "type": "VARCHAR(255)",
      "javaType": "String",
      "nullable": false,
      "validation": {
        "required": true,
        "maxLength": 255,
        "sanitize": true
      },
      "description": "Task title"
    },
    {
      "name": "completed",
      "type": "BOOLEAN",
      "javaType": "Boolean",
      "nullable": false,
      "validation": {
        "required": true
      },
      "description": "Task completion status"
    },
    {
      "name": "created_at",
      "type": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP",
      "javaType": "LocalDateTime",
      "autoGenerated": true,
      "description": "Creation timestamp"
    }
  ],
  "operations": {
    "create": true,
    "read": true,
    "update": true,
    "delete": true,
    "list": true
  }
}
```

### Complex Entity with Relationships

```json
{
  "service": {
    "name": "order",
    "description": "Order management service"
  },
  "database": {
    "table": "orders",
    "entity": "Order"
  },
  "fields": [
    {
      "name": "id",
      "type": "BIGSERIAL",
      "javaType": "Long",
      "primaryKey": true,
      "autoGenerated": true,
      "description": "Order ID"
    },
    {
      "name": "user_id",
      "type": "BIGINT",
      "javaType": "Long",
      "nullable": false,
      "foreignKey": {
        "table": "auth_users",
        "field": "id",
        "onDelete": "CASCADE"
      },
      "validation": {
        "required": true
      },
      "description": "Customer ID"
    },
    {
      "name": "order_number",
      "type": "VARCHAR(50)",
      "javaType": "String",
      "nullable": false,
      "validation": {
        "required": true,
        "maxLength": 50,
        "pattern": "^ORD-[0-9]{6}$"
      },
      "description": "Unique order number"
    },
    {
      "name": "total_amount",
      "type": "DECIMAL(10,2)",
      "javaType": "BigDecimal",
      "nullable": false,
      "validation": {
        "required": true,
        "min": 0,
        "precision": 10,
        "scale": 2
      },
      "description": "Total order amount"
    },
    {
      "name": "status",
      "type": "VARCHAR(20)",
      "javaType": "String",
      "nullable": false,
      "validation": {
        "required": true,
        "maxLength": 20
      },
      "description": "Order status"
    },
    {
      "name": "order_date",
      "type": "TIMESTAMP",
      "javaType": "LocalDateTime",
      "nullable": false,
      "validation": {
        "required": true
      },
      "description": "Order date"
    },
    {
      "name": "created_at",
      "type": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP",
      "javaType": "LocalDateTime",
      "autoGenerated": true,
      "description": "Creation timestamp"
    },
    {
      "name": "updated_at",
      "type": "TIMESTAMP DEFAULT CURRENT_TIMESTAMP",
      "javaType": "LocalDateTime",
      "autoGenerated": true,
      "updateOnModify": true,
      "description": "Last update timestamp"
    }
  ],
  "operations": {
    "create": true,
    "read": true,
    "update": true,
    "delete": true,
    "list": true,
    "pagination": true,
    "customQueries": [
      {
        "name": "findByUserId",
        "description": "Find orders by user ID",
        "query": "SELECT * FROM {tableName} WHERE user_id = ? ORDER BY order_date DESC",
        "parameters": ["Long userId"],
        "returnType": "List<{entity}>"
      },
      {
        "name": "findByStatus",
        "description": "Find orders by status",
        "query": "SELECT * FROM {tableName} WHERE status = ? ORDER BY order_date DESC",
        "parameters": ["String status"],
        "returnType": "List<{entity}>"
      }
    ]
  }
}
```

## üìÅ Generated Files

### File Structure
```
src/main/java/com/vira/{service}/
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}Controller.java
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}Service.java
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}Repository.java
‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}.java
‚îî‚îÄ‚îÄ dto/
    ‚îú‚îÄ‚îÄ {Entity}Request.java
    ‚îî‚îÄ‚îÄ {Entity}Response.java

src/test/java/com/vira/{service}/
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ {Entity}ControllerTest.java
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}ControllerIntegrationTest.java
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}ServiceTest.java
‚îî‚îÄ‚îÄ repository/
    ‚îî‚îÄ‚îÄ {Entity}RepositoryTest.java

src/main/resources/
‚îú‚îÄ‚îÄ db/migration/
‚îÇ   ‚îî‚îÄ‚îÄ V{version}_Create_{service}_{table}.sql
‚îî‚îÄ‚îÄ frontend/
    ‚îú‚îÄ‚îÄ api/
    ‚îÇ   ‚îî‚îÄ‚îÄ {entity}ApiService.js
    ‚îî‚îÄ‚îÄ types/
        ‚îî‚îÄ‚îÄ {entity}Types.ts
```

### Generated Code Quality
- **Full Type Safety** - Comprehensive TypeScript definitions
- **Complete Validation** - Bean validation on all DTOs
- **Security First** - XSS protection, SQL injection prevention
- **Test Coverage** - Unit and integration tests
- **Documentation** - Comprehensive JavaDoc and API docs
- **Error Handling** - Proper exception handling throughout
- **Performance** - Database indexes and optimized queries

## üêõ Troubleshooting

### Common Issues

#### ‚ùå "Configuration file not found"
**Solution:**
```bash
# Check file exists
ls -la config.json

# Use absolute path
python generator.py --config "C:/full/path/to/config.json"
```

#### ‚ùå "Vira services root directory doesn't exist"
**Solution:**
```json
// Update config.json with correct paths
{
  "paths": {
    "vira_services_root": "C:/correct/path/to/vira_services"
  }
}
```

#### ‚ùå "Invalid service name"
**Solution:**
```json
// Service names must be alphanumeric
{
  "service": {
    "name": "blogservice"  // ‚úÖ Good
    // "name": "blog-service"  // ‚ùå Bad (contains hyphen)
    // "name": "blog service"  // ‚ùå Bad (contains space)
  }
}
```

#### ‚ùå "Invalid table name"
**Solution:**
```json
// Table names must be lowercase with underscores
{
  "database": {
    "table": "blog_posts"  // ‚úÖ Good
    // "table": "BlogPosts"   // ‚ùå Bad (PascalCase)
    // "table": "blog-posts"  // ‚ùå Bad (contains hyphen)
  }
}
```

#### ‚ùå "Template not found"
**Solution:**
```bash
# Ensure templates directory exists
mkdir templates

# Check all template files exist
ls templates/
```

#### ‚ùå "Permission denied"
**Solution:**
```bash
# Windows: Run as administrator
# Linux/Mac: Use sudo or check file permissions
chmod +x generator.py
```

### Validation Errors

#### ‚ùå "At least one field must be marked as primaryKey"
**Solution:**
```json
{
  "fields": [
    {
      "name": "id",
      "type": "BIGSERIAL",
      "javaType": "Long",
      "primaryKey": true,  // ‚úÖ Add this
      "autoGenerated": true
    }
  ]
}
```

#### ‚ùå "Field validation error"
**Solution:**
```json
{
  "name": "email_address",  // ‚úÖ snake_case
  "type": "VARCHAR(255)",   // ‚úÖ Valid PostgreSQL type
  "javaType": "String",     // ‚úÖ Valid Java type
  "validation": {
    "required": true,
    "maxLength": 255,       // ‚úÖ Matches VARCHAR length
    "email": true
  }
}
```

### Runtime Issues

#### ‚ùå "Failed to determine migration version"
**Solution:**
```bash
# Create migration directory
mkdir -p src/main/resources/db/migration

# Check permissions
chmod 755 src/main/resources/db/migration
```

#### ‚ùå "Rollback failed"
**Solution:**
```bash
# Check backup directory
ls backups/

# Manually restore if needed
cp backups/backup_*/src/main/java/* src/main/java/
```

### Debugging Tips

1. **Enable Verbose Logging**
   ```bash
   python generator.py --verbose
   ```

2. **Check Log Files**
   ```bash
   # View latest log
   tail -f logs/generator_*.log
   
   # Search for errors
   grep -i error logs/generator_*.log
   ```

3. **Validate JSON**
   ```bash
   # Use online JSON validator
   # Or Python:
   python -m json.tool service_definition.json
   ```

4. **Test Database Connection**
   ```bash
   # Check PostgreSQL connection
   psql -h localhost -U your_user -d your_database
   ```

## üîß Advanced Usage

### Custom Templates

You can modify templates in the `templates/` directory to customize generated code:

```bash
templates/
‚îú‚îÄ‚îÄ model.java.j2          # JPA Entity template
‚îú‚îÄ‚îÄ repository.java.j2     # Repository interface template
‚îú‚îÄ‚îÄ service.java.j2        # Service class template
‚îú‚îÄ‚îÄ controller.java.j2     # REST Controller template
‚îú‚îÄ‚îÄ request_dto.java.j2    # Request DTO template
‚îú‚îÄ‚îÄ response_dto.java.j2   # Response DTO template
‚îú‚îÄ‚îÄ migration.sql.j2       # SQL migration template
‚îî‚îÄ‚îÄ react_api_service.js.j2 # React API service template
```

### Environment-Specific Configs

Create multiple config files for different environments:

```bash
config-dev.json     # Development paths
config-prod.json    # Production paths
config-local.json   # Local development
```

```bash
# Use specific config
python generator.py --config config-dev.json
```

### Batch Generation

Generate multiple services at once:

```bash
# Create multiple service definitions
services/
‚îú‚îÄ‚îÄ blog_service.json
‚îú‚îÄ‚îÄ inventory_service.json
‚îî‚îÄ‚îÄ order_service.json

# Generate each service
for service in services/*.json; do
    python generator.py --definition "$service"
done
```

### Custom Validation

Add custom validation rules by modifying the `_validate_service_definition` method in `generator.py`.

## üöÄ Best Practices

### Service Design
- Use descriptive service names
- Follow single responsibility principle
- Include proper field descriptions
- Add appropriate indexes for queries

### Database Design
- Always include `created_at` and `updated_at`
- Use proper foreign key constraints
- Add validation at both database and application level
- Consider soft deletes for important data

### API Design
- Use consistent naming conventions
- Include proper HTTP status codes
- Add comprehensive error handling
- Document all endpoints

### Security
- Always enable sanitization for text fields
- Use proper validation annotations
- Implement authorization checks
- Sanitize input data

## ü§ù Contributing

### Reporting Issues

1. Check existing issues
2. Provide minimal reproduction case
3. Include error logs
4. Specify your environment

### Feature Requests

1. Describe the use case
2. Provide example configuration
3. Explain expected behavior

### Code Contributions

1. Follow existing code style
2. Add appropriate tests
3. Update documentation
4. Test with multiple scenarios

## üìÑ License

This project is part of the Vira Services ecosystem. Use according to your project's license terms.

## üÜò Support

### Getting Help

1. **Check Documentation** - Read this README thoroughly
2. **Review Examples** - Check the `examples/` directory
3. **Check Logs** - Look at generated log files
4. **Search Issues** - Look for similar problems

### Quick Reference

```bash
# Basic usage
python generator.py

# With custom config
python generator.py --config my_config.json --definition my_service.json

# Enable verbose logging
python generator.py --verbose

# Validate JSON format
python -m json.tool service_definition.json
```

---

**üéâ Happy Coding!** Generate beautiful, production-ready Spring Boot services with just a few JSON configurations! 